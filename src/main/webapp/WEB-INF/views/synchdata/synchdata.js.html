<script type="text/javascript" src='lib/plupload/json2.min.js'></script>
<script type="text/javascript" src='lib/plupload/plupload.full.min.js'></script>
<script type="text/javascript" src='lib/plupload/i18n/zh_CN.js'></script>
<script type="text/javascript">
    var baseUrl = '$link.getContextURL()/synchdata';
    $(function () {
        $('#dg').datagrid({
        });
        $("a[select-dialog]").each(function() {
            $(this).click(function(){
                var $this = $(this);
                var _callbackname = $this.attr("callback");
                var _url = $this.attr("select-dialog");
                var _callback_fn = window[_callbackname];
                var dfn = top.window.openSelectDialogFrameDialog;
                console.log(dfn);
                if (typeof dfn === "function") {
                    dfn(_url, _callback_fn);
                }
                return false;
            })
        });
    });

    function getConditions() {
        var f = $("#queryForm").serializeArray();
        var searchConditions = {};
        for (var i = 0; i < f.length; i++) {
            searchConditions[f[i].name] = f[i].value;
        }
        return searchConditions;
    }

    $('#dg').datagrid({'onBeforeLoad':function(param){
        $.extend(param,getConditions());
    }});

    //进入数据源选择界面
    function add() {
       $("#dlg").dialog("open");
    }
    //提交数据源：
    function submit(){
        var val = $("#synchDataFlag").combobox('getValue');
        if(val){
            $.post(baseUrl + "/savesynchdatatask.json", $("#choseform").serialize(), function(result) {
                if (result) {
                    window.location = baseUrl + "/list";
                } else {
                    $.messager.show({
                    title: "提示",
                    msg: "同步数据失败！"
                });
            }
        });
       }else{
           $.messager.show({
               title:"错 误",
               msg:"数据来源不能为空！"
           })
       }
    }
    function close(){
        $("#dlg").dialog("close");
    }

    function edit() {
        var row = $('#dg').datagrid('getSelected');
        if(row){
            window.location = baseUrl + '/edituser?id=' + row.id;
        }
    }
    //提交APK文件保存信息
    function save() {
        var flag = $("#editForm").form('validate');
        if (flag) {
            $.post(baseUrl + "/saveapk.json", $("#editForm").serialize(), function(result) {
                if (result) {
                    window.location = baseUrl + "/list";
                } else {
                    $.messager.show({
                        title: "提示",
                        msg: "保存APK文件失败！"
                    });
                }
            });
        }
    }
    //返回列表界面
    function back(){
        window.location = baseUrl + "/list";
    }
</script>