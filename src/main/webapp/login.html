<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title></title>
<link rel="stylesheet" type="text/css" href="css/login.css">
</head>

<body>
    <div id="login">
        <div id="login-bg">
            <div class="login-logo"><img src="images/login-logo.png"></div>
            <form action="common/login" method="post" name="loginForm" id="loginForm" class="login-form">
                    <label>帐号&nbsp;&nbsp;
                        <input id="account" class="login-account" type="text" name="account" required autofocus placeholder="请输入您的帐号" />
                    </label>
                    <label>密码&nbsp;&nbsp;
                           <input id="password" class="login-password" type="password" name="password" required placeholder="请输入您的密码"/>
                    </label>
                    <input type="submit" class="login-btn" value="登录"/>
                    <span id="login-error" class="login-error" style="display: none">请输入账号</span>
                </form>
            <div class="login-copyright">Copyright 2015 广西壮族自治区食品药品监督管理局 All Rights Reserved.</div>
        </div>
    </div>

    <script src="lib/jquery/jquery-1.11.1.min.js" type="text/javascript"></script>

    <script type="text/javascript">
        if (window.location !== top.location) {
            top.location = window.location;
        }

        document.getElementById("account").focus();

        $('#account').keypress(function(e) {
            if (e.which == 13) {
                $('#password').focus();
                return false;
            }
        });

        $('#password').keypress(function(e) {
            if (e.which == 13) {
                $('#loginForm').submit();
                return false;
            }
        });

        $('#loginForm').submit(function() {

            var error = $("#login-error");
            error.hide();

            var acc = $("#account");
            var psw = $("#password");

            if (acc && psw) {
                if (acc.val() == "") {
                    error.show().html("请输入用户名！");
                    acc.focus();
                } else if (psw.val() == "") {
                    error.show().html("请输入密码！");
                    psw.focus();
                } else {
                    formSubmit();
                }
            }

            return false;
        });

        function formSubmit() {
            var form = $('#loginForm');

            var url = form.attr('action');
            var method = form.attr('method');

            $.ajax({
                type : method,
                url : url,
                data : form.serialize(),
                success : function(data) {
                    console.log(data);
                    if (data) {
                        if (-1 != data.indexOf("用户名或密码错误")) {
                            $("#login-error").show().html("用户名或密码错误！");
                            $("#account").focus();
                        } else {
                            var d = new Date();
                            top.location = 'index.html?' + d.getTime();
                        }
                    } else {
                        $("#login-error").show().html("服务器异常响应，无法登录！");
                    }
                },
                error : function() {
                    $("#login-error").show().html("向服务器提交请求失败，无法登录！");
                }
            });
        }
    </script>

    <script type="text/javascript">
    </script>
</body>
</html>
